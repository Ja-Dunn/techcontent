<properties 
    pageTitle="服务总线常见问题解答 | Azure"
    description="回答了一些关于 Azure 服务总线的常见问题。"
    services="service-bus"
    documentationCenter="na"
    authors="justinconway"
    manager=""
    editor="" />
<tags 
    ms.service="service-bus"
    ms.date="06/09/2016"
    wacn.date="07/25/2016" />

# 服务总线常见问题解答

本文回答了一些关于 Microsoft Azure 服务总线的常见问题。你还可以访问 [Azure 支持 FAQ](http://go.microsoft.com/fwlink/?LinkID=185083) 了解一般的 Azure 定价和支持信息。本文涵盖以下主题：

- [关于 Azure 服务总线消息传送的一般问题](#general-questions-about-azure-service-bus-messaging)
- [服务总线最佳实践](#service-bus-best-practices)
- [服务总线定价](#service-bus-pricing)
- [服务总线配额](#service-bus-quotas)
- [订阅和命名空间管理](#subscription-and-namespace-management)
- [故障排除](#service-bus-troubleshooting)

## 关于 Azure 服务总线消息传送的一般问题

### 什么是 Azure 服务总线消息传送？

[Azure 服务总线消息传送](/documentation/articles/service-bus-messaging-overview/)是一个异步消息传送云平台，可让你在分离的系统之间发送数据。Microsoft 以服务的形式提供 Azure 服务总线消息传送，这表示你不需要托管任何自有硬件就能使用它。

### 什么是服务总线命名空间？

命名空间提供了用于对应用程序中的 Service Bus 资源进行寻址的范围容器。必须创建命名空间才能使用服务总线，而且这也是入门的第一步。

### 什么是 Azure 服务总线队列？

[服务总线队列](/documentation/articles/service-bus-queues-topics-subscriptions/)是用于存储消息的实体。当你有多个应用程序，或者多个需要彼此通信的分布式应用程序部分时，队列特别有用。队列和发行中心的相似之处在于，两者都会接收多个产品（消息），再从该处送出。

### 什么是 Azure 服务总线主题和订阅？

主题可以可视化为队列，而且在使用多个订阅时，主题会变成更丰富的消息传送模型；实质上是一对多的通信工具。此发布/订阅模型（即 pub/sub）可让应用程序使用多个订阅将消息发送到主题，以便让多个应用程序接收该消息。

### 什么是 Azure 服务总线中继服务？

[中继服务](/documentation/articles/service-bus-relay-overview/)提供以透明方式托管 WCF 服务并从任意位置访问 WCF 服务的能力。换而言之，此服务可让混合应用程序在 Azure 数据中心和本地企业环境中运行。

### 什么是分区实体？

传统的队列或主题由单个消息中转站进行处理并存储在一个消息传送存储中。[分区队列或主题](/documentation/articles/service-bus-partitioning/)由多个消息代理处理，并存储在多个消息传送存储中。这意味着分区的队列或主题的总吞吐量不再受到单个消息中转站或消息传送存储的性能所限制。此外，消息传送存储的临时中断不会导致分区的队列或主题不可用。

请记住，使用分区实体时不保证排序。如果某个分区不可用，你仍可从其他分区发送和接收消息。

## 服务总线最佳实践

### Azure 服务总线的最佳实践有哪些？

-   [使用服务总线中转消息传送改进性能的最佳实践][] — 本文说明如何在交换中转消息时优化性能。

-   [使应用程序免受服务总线中断和灾难影响的最佳实践][] — 本文讨论如何最大程度地避免中继终结点、队列和主题以及主动和被动复制发生数据中心服务中断。

###创建消息传送实体前的须知事项有哪些？   

队列和主题的以下属性是固定不变的。预配实体时请考虑到这一点，因为若要修改属性，就必须创建新的替代实体。

-   大小

-   分区

-   会话

-   重复检测

-   快速实体

## 服务总线定价

本部分回答了一些关于服务总线定价结构的常见问题。你还可以访问 [Azure 支持常见问题](http://go.microsoft.com/fwlink/?LinkID=185083)了解一般的 Azure 定价信息。有关服务总线定价的完整信息，请参阅[服务总线定价](/pricing/details/messaging/)。

### 服务总线如何收取费用？

有关服务总线定价的完整信息，请参阅[服务总线定价详细信息][Pricing overview]。除标示的价格外，你还需为在其中部署应用程序的数据中心之外的相关数据输出支付费用。

### 服务总线的哪些使用情况受数据传输限制？ 哪些不受其限制？

在给定的 Azure 区域内的任何数据传输均不收费。

### 如何计算中继小时数？

将按每个服务总线中继在指定计费期间处于“打开”状态的累积时间量对中继小时数收费。当启用了中继的 WCF 服务（即“中继侦听器”）第一次连接到给定服务总线地址（服务命名空间 URL）时，中继将隐式实例化并在该地址中打开。仅当最后一个侦听器从其地址断开连接时，该中继才会关闭。因此，出于计费目的，在第一个中继侦听器连接到中继的服务总线地址到最后一个中继侦听器从该地址断开连接的这段时间内，该中继将被认为处于“打开”状态。换而言之，当有一个或多个中继侦听器连接到其服务总线地址时，中继都将被认为处于打开状态。

### 如果将多个侦听器连接到给定中继，会怎么样？

在某些情况下，服务总线中的单个中继可能会有多个连接的侦听器。这种情况可能会出现在使用 netTCPRelay 或 HttpRelay WCF 绑定的负载均衡服务中，或出现在使用 netEventRelay WCF 绑定的广播事件侦听器中。当至少有一个中继侦听器连接到中继服务总线时，该中继都就将被视为“打开”状态。出于计费目的将其他侦听器添加到打开的中继时，不会更改该中继的状态。连接到中继的中继发送方（调用或将消息发送至中继的客户端）数量也不会对中继小时数的计算产生影响。

### 如何计算中继的消息数？

一般而言，使用与上述用于描述中转实例（队列、主题和订阅）相同的方法来计算中继的可计费消息数。但是，有几个明显的区别：

将消息发送到服务总线中继是指将消息“全通式”发送至中继侦听器，而不是发送至服务总线中继后再传递到中继侦听器。因此，针对中继侦听器的请求-应答服务调用（最大 64 KB）将生成两条可计费消息：一条用于请求的可计费消息和一条用于应答（假设响应也不超过 64 KB）的可计费消息。这不同于使用队列在客户端和服务之间进行调谐。对于后一种情况，相同的请求-应答模式需要一个发送到队列的请求，接着是从队列取消排队/从队列传递到服务，然后是发送至另一个队列的响应，最后从该队列取消排队/从该队列传递到客户端。因此，使用相同大小 (<= 64 KB) 的假设吞吐量，经过调谐的队列模式将生成四条可计费消息，此数量是使用中继实现相同模式的计费数的两倍。当然，使用队列来实现此模式好处更多，例如持久性和负载分级。这些好处可能产生额外费用。

使用 netTCPRelay WCF 绑定打开的中继不将消息视为单条消息，而视为流经系统的数据流。换而言之，只有发送方和侦听器可以识别使用此绑定发送/接收的单条分帧消息。因此，对于使用 netTCPRelay 绑定的中继，所有数据都将被视为用于计算计费消息的数据流。在此示例中，服务总线将计算每 5 分钟通关单个中继发送或接收的数据总量，然后将该总量除以 64 KB，从而得出在该时间段出现问题的中继的可计费消息数。

### 服务总线是否对存储收费？

否，服务总线不对存储收费。但是，对每个队列/主题可以保留的数据最大量设有配额限制。请参阅下一个常见问题。

## 服务总线配额

有关服务总线限制和配额的列表，请参阅[配额概述][]。

### 服务总线是否有任何使用率配额？

默认情况下，对于任何云服务，Microsoft 每月都会设置聚合的使用率配额，此配额基于客户的所有订阅进行计算。由于我们清楚你可能需要这些限制之外的更多限制，因此，请随时联系客户服务，以便我们了解你的需求并相应地调整这些限制。对于服务总线，聚合的使用率配额为如下所示：

- 50 亿条消息
- 200 万个中继小时

虽然我们保留禁用在给定月份超过使用率配额的客户帐户的权利，但我们仍然会在采取任何措施前发送电子邮件通知并会多次尝试与客户联系。超过这些配额的客户仍将负责超出配额的费用。

至于 Azure 上的其他服务，服务总线会强制使用一组特定配额，以确保资源的公平使用。服务强制执行的使用率配额如下：

#### 队列/主题大小

在创建队列或主题时指定最大队列或主题大小。此配额的值可以是 1 GB、2 GB、3 GB、4 GB 或 5 GB。如果达到最大大小，则将拒绝其他传入的消息，调用代码将收到一个异常。

#### 并发连接数

队列/主题/订阅 — 队列/主题/订阅上的并发 TCP 连接数限制为 100 个。如果达到此配额，将拒绝后续的其他连接请求，调用代码将收到一个异常。对于每个消息工厂，如果由该消息传送工厂创建的任何客户端具有活动的操作挂起时，或者刚完成操作不超过 60 秒时间，则服务总线都会保持一个 TCP 连接。REST 操作不计入并发 TCP 连接数。

#### 中继上的并发侦听器数

中继上的并发 **netTcpRelay** 和 **netHttpRelay** 侦听器数限制为 25 个（1 表示 **NetOneway** 中继）。

#### 每个命名空间的并发中继侦听器数

服务总线对每个服务命名空间强制的并发中继侦听器数为 2000 个。如果达到此配额，将拒绝后续的打开其他中继侦听器连接的请求，调用代码将收到一个异常。

#### 每个服务命名空间的主题/队列数

服务命名空间上的主题/队列（持久存储备份的实体）的最大数限制为 10,000 个。如果达到此配额，将拒绝后续的在服务命名空间上创建新主题/队列的请求。在这种情况下，Azure 经典管理门户将显示一条错误消息或调用客户端代码将收到一个异常，具体取决于创建尝试是通过门户还是通过客户端代码完成的。

### 消息大小配额

#### 队列/主题/订阅

**消息大小** – 每条消息的总大小限制为 256 KB，包括消息标头。

**消息标头大小** – 每条消息标头限制为 64 KB。

**NetOneway 和 NetEvent 中继** – 每条消息的总大小限制为 64 KB，包括消息标头。

**Http 和 NetTcp 中继** – 服务总线不强制设置这些消息的大小上限。

系统将拒绝超过这些大小配额的消息，调用代码将收到一个异常。

**每个主题的订阅数** – 每个主题的最大订阅数被限制为 2000。如果达到此配额，则将拒绝创建该主题的附加订阅的请求。在这种情况下，Azure 经典门户将显示一条错误消息或调用客户端代码将收到一个异常，具体取决于创建尝试是通过门户还是通过客户端代码完成的。

**每个主题的 SQL 筛选器数** – 每个主题的最大 SQL 筛选器数被限制为 2,000。如果达到此配额，将拒绝任何后续的创建该主题的其他筛选器的请求，调用代码将收到一个异常。

**每个主题的相关筛选器数** – 每个主题的最大相关筛选器数被限制为 100,000。如果达到此配额，将拒绝任何后续的创建该主题的其他筛选器的请求，调用代码将收到一个异常。

## 订阅和命名空间管理

### 如何将命名空间迁移到另一个 Azure 订阅？

你可以使用 PowerShell 命令（可在[此处][]的文章中找到）将命名空间从某个 Azure 订阅移到另一个 Azure 订阅。若要执行此操作，命名空间必须已处于活动状态。此外，执行命令的用户必须是源订阅和目标订阅的管理员。

## 服务总线故障排除

[异常概述][]

### Azure 服务总线消息传送 API 所生成的异常有哪些？建议采取什么操作？

消息传送 API 可能生成的异常分为以下类别：

-   用户编码错误

-   设置/配置错误

-   临时异常

-   其他异常

[服务总线消息传送异常][Exceptions overview]一文介绍了部分异常和建议的操作。

### 什么是共享访问签名？哪些语言支持生成签名？

共享访问签名是基于 SHA–256 安全哈希或 URI 的身份验证机制。有关如何在 Node、PHP、Java 和 C# 中生成自有签名的信息，请参阅[共享访问签名][]一文。

## 后续步骤

若要了解有关服务总线消息传送的详细信息，请参阅以下主题。

- [Azure 服务总线高级消息传送简介（博客文章）](http://azure.microsoft.com/blog/introducing-azure-service-bus-premium-messaging/)
- [Azure 服务总线高级消息传送简介（Channel9）](https://channel9.msdn.com/Blogs/Subscribe/Introducing-Azure-Service-Bus-Premium-Messaging)
- [服务总线消息传送概述](/documentation/articles/service-bus-messaging-overview/)
- [Azure 服务总线体系结构概述](/documentation/articles/service-bus-fundamentals-hybrid-solutions/)
- [服务总线队列入门](/documentation/articles/service-bus-dotnet-get-started-with-queues/)

[使用服务总线中转消息传送改进性能的最佳实践]: /documentation/articles/service-bus-performance-improvements/
[使应用程序免受服务总线中断和灾难影响的最佳实践]: /documentation/articles/service-bus-outages-disasters/
[Pricing overview]: /pricing/details/messaging/
[配额概述]: /documentation/articles/service-bus-quotas/
[此处]: /documentation/articles/service-bus-powershell-how-to-provision/#migrate-a-namespace-to-another-azure-subscription
[Exceptions overview]: /documentation/articles/service-bus-messaging-exceptions/
[异常概述]: /documentation/articles/service-bus-messaging-exceptions/
[共享访问签名]: /documentation/articles/service-bus-sas-overview/

<!---HONumber=Mooncake_0718_2016-->